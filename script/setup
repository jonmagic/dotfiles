#!/usr/bin/env bash

if ! command -v brew &> /dev/null
then
    echo "-> Installing Homebrew"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

echo "-> Downloading latest antigen.zsh"
curl -sL git.io/antigen > ~/.dotfiles/antigen.zsh

if [ ! -f ~/.zshrc ]; then
    echo "-> Copying .zshrc to home folder"
    cp zshrc.original ~/.zshrc
    echo
    echo "Close this terminal and open a new one and run script/setup again from ~/.dotfiles directory."
    echo
    exit 1
fi

echo "-> Installing homebrew packages"
brew bundle --file=~/.dotfiles/install/Brewfile

if [[ $OSTYPE == darwin* && $CPUTYPE == arm64 ]]; then
    echo "-> Installing homebrew Cask packages"
    brew bundle --file=~/.dotfiles/install/Caskfile
fi

if ! plutil -extract Window\ Settings.One\ Dark xml1 -o - ~/Library/Preferences/com.apple.Terminal.plist > /dev/null; then
    echo "-> Importing Terminal themes"
    ~/.dotfiles/themes/import.sh
fi

if [ ! -d ~/github ]; then
    echo "-> Creating ~/github directory"
    mkdir -p ~/github
fi

if [ ! -d ~/github/vpn ]; then
    echo "-> Cloning github/vpn"
    cd ~/github
    git clone https://github.com/github/vpn
fi
